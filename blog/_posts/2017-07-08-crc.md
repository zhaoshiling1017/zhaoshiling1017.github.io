---
layout: post
title: 校验码
category: thinking
---

# 奇偶校验码

二进制数据经过传送、存取等环节，会发生误码（1变成0或0变成1），这就有如何发现及纠正误码的问题。所有解决此类问题的方法就是在原始数据（数码位）基础上增加几位校验（冗余）位。

## 码距

一个编码系统中任意两个合法编码（码字）之间不同的二进数位（bit）数叫这两个码字的码距，而整个编码系统中任意两个码字的的最小距离就是该编码系统的码距。

如 图1所示的一个编码系统，用三个bit来表示八个不同信息中。在这个系统中，两个码字之间不同的bit数从1到3不等，但最小值为1，故这个系统的码距为 1。如果任何码字中一位或多位被颠倒了，结果这个码字就不能与其它有效信息区分开。例如，如果传送信息001，而被误收为011，因011仍是表中的合法 码字，接收机仍将认为011是正确的信息。

然而，如果用四个二进数字来编8个码字，那么在码字间的最小距离可以增加到2，如图2的表中所示。

![](http://orxw8wy2g.bkt.clouddn.com/crc1.jpg)

注 意，图2的8个码字相互间最少有两bit的差异。因此，如果任何信息的一个数位被颠倒，就成为一个不用的码字，接收机能检查出来。例如信息是1001，误 收为1011，接收机知道发生了一个差错，因为1011不是一个码字（表中没有）。然而，差错不能被纠正。假定只有一个数位是错的，正确码字可以是 1001，1111，0011或1010。接收者不能确定原来到底是这4个码字中的那一个。也可看到， 在这个系统中，偶数个（2或4）差错也无法发现。
为了使一个系统能检查和纠正一个差错，码间最小距离必须至少是"3"。最小距离为3时，或能纠正一个错，或能检二个错，但不能同时纠一个错和检二个错。编码信息纠错和检错能力的进一步提高需要进一步增加码字间的最小距离。 图3的表概括了最小距离为1至7的码的纠错和检错能力。

![](http://orxw8wy2g.bkt.clouddn.com/crc2.jpg)

为了使一个系统能检查和纠正一个差错，码间最小距离必须至少是"3"。最小距离为3时，或能纠正一个错，或能检二个错，但不能同时纠一个错和检二个错。编码信息纠错和检错能力的进一步提高需要进一步增加码字间的最小距离。 

码距越大，纠错能力越强，但数据冗余也越大，即编码效率低了。所以，选择码距要取决于特定系统的参数。数字系统的设计者必须考虑信息发生差错的概率和该系统能容许的最小差错率等因素。要有专门的研究来解决这些问题。

## 奇偶校验

奇偶校验码是一种增加二进制传输系统最小距离的简单和广泛采用的方法。例如，单个的奇偶校验将使码的最小距离由一增加到二。

一个二进制码字，如果它的码元有奇数个1，就称为具有奇性。例如，码字“10110101”有五个1，因此，这个码字具有奇性。同样，偶性码字具有偶数个1。注意奇性检测等效于所有码元的模二加，并能够由所有码元的异或运算来确定。对于一个n位字，奇性由下式给出：
奇性=a0⊕a1⊕a2⊕…⊕an

奇 偶校验可描述为：给每一个码字加一个校验位，用它来构成奇性或偶性校验。例如，在图2中，就是这样做的。可以看出，附加码元d2，是简单地用来使每个字成 为偶性的。因此，若有一个码元是错的，就可以分辨得出，因为奇偶校验将成为奇性。奇偶校验编码通过增加一位校验位来使编码中1个个数为奇数（奇校验）或者 为偶数（偶校验），从而使码距变为2。因为其利用的是编码中1的个数的奇偶性作为依据，所以不能发现偶数位错误。

再以数字0的七位ASCII码（0110000）为例，如果传送后右边第一位出错，0变成1。接收端还认为是一个合法的代码0110001（数字1的 ASCII码）。若在最左边加一位奇校验位，编码变为10110000，如果传送后右边第一位出错，则变成10110001，1的个数变成偶数，就不是合法的奇校验码了。但若有两位（假设是第1、2位）出错就变成10110011，1的个数为5，还是奇数。接收端还认为是一个合法的代码（数字3的 ASCII码）。所以奇偶校验不能发现。
奇偶校验位可由硬件电路（异或门）或软件产生：
偶校验位 an =a0⊕a1⊕a2⊕…⊕an-1， 奇校验位 an =NOT（a0⊕a1⊕a2⊕…⊕an-1）。
在一个典型系统里，在传输以前，由奇偶发生器把奇偶校验位加到每个字中。原有信息中的数字在接收机中被检测， 如果没有出现正确的奇、偶性，这个信息标定为错误的，这个系统将把错误的字抛掉或者请求重发。

在实际工作中还经常采用纵横都加校验奇偶校验位的编码系统--分组奇偶校验码。
现在考虑一个系统， 它传输若干个长度为m位的信息。如果把这些信息都编成每组n个信息的分组，则在这些不同的信息间，也如对单个信息一样，能够作奇偶校验。图4中n个信息的一个分组排列成矩形式样，并以横向奇偶（HP）及纵向奇偶（VP）的形式编出奇偶校验位。

![](http://orxw8wy2g.bkt.clouddn.com/crc3.jpg)


# 海明校验

我们在前面指出过要能纠正信息字中的单个错误，所需的最小距离为3。实现这种纠正的方法之一是海明码。
海 明码是一种多重(复式)奇偶检错系统。它将信息用逻辑形式编码，以便能够检错和纠错。用在海明码中的全部传输码字是由原来的信息和附加的奇偶校验位组成 的。每一个这种奇偶位被编在传输码字的特定位置上。实现得合适时，这个系统对于错误的数位无论是原有信息位中的，还是附加校验位中的都能把它分离出来。

推导并使用长度为m位的码字的海明码，所需步骤如下：
1、确定最小的校验位数k，将它们记成D1、D2、…、Dk，每个校验位符合不同的奇偶测试规定。
2、原有信息和k个校验位一起编成长为m+k位的新码字。选择k校验位（0或1）以满足必要的奇偶条件。
3、对所接收的信息作所需的k个奇偶检查。
4、如果所有的奇偶检查结果均为正确的，则认为信息无错误。
如果发现有一个或多个错了，则错误的位由这些检查的结果来唯一地确定。

校验位数的位数

推 求海明码时的一项基本考虑是确定所需最少的校验位数k。考虑长度为m位的信息，若附加了k个校验位，则所发送的总长度为m+k。在接收器中要进行k个奇偶 检查，每个检查结果或是真或是伪。这个奇偶检查的结果可以表示成一个k位的二进字，它可以确定最多2k种不同状态。 这些状态中必有一个其所有奇偶测试试都是真的，它便是判定信息正确的条件。于是剩下的（2k-1）种状态，可以用来判定误码的位置。于是导出下一关系：
											2k-1≥m+k

码字格式

从理论上讲，校验位可放在任何位置，但习惯上校验位被安排在1、2、4、8、…的位置上。


# 循环冗余校验码（CRC）

在串行传送（磁盘、通讯）中，广泛采用循环冗余校验码（CRC）。CRC也是给信息码加上几位校验码，以增加整个编码系统的码距和查错纠错能力。

CRC的理论很复杂，一般书上只介绍已有生成多项式后计算校验码的方法。检错能力与生成多项式有关，只能根据书上的结论死记。
循 环冗余校验码（CRC）的基本原理是：在K位信息码后再拼接R位的校验码，整个编码长度为N位，因此，这种编码又叫（N，K）码。对于一个给定的 （N，K）码，可以证明存在一个最高次幂为N-K=R的多项式G(x)。根据G(x)可以生成K位信息的校验码，而G(x)叫做这个CRC码的生成多项 式。

校验码的具体生成过程为：假设发送信息用信息多项式C(X)表示，将C(x)左移R位，则可表示成C(x)\*2R，这样C(x)的右边就会空出R位，这就是校验码的位置。通过C(x)\*2R除以生成多项式G(x)得到的余数就是校验码。

几个基本概念

1、多项式与二进制数码
多项式和二进制数有直接对应关系：x的最高幂次对应二进制数的最高位，以下各位对应多项式的各幂次，有此幂次项对应1，无此幂次项对应0。可以看出：x的最高幂次为R，转换成对应的二进制数有R+1位。
多项式包括生成多项式G(x)和信息多项式C(x)。
如生成多项式为G(x)=x4+x3+x+1， 可转换为二进制数码11011。
而发送信息位 1111，可转换为数据多项式为C(x)=x3+x2+x+1。

2、生成多项式
是接受方和发送方的一个约定，也就是一个二进制数，在整个传输过程中，这个数始终保持不变。
在发送方,利用生成多项式对信息多项式做模2除生成校验码。在接受方利用生成多项式对收到的编码多项式做模2除检测和确定错误位置。
应满足以下条件：
a、生成多项式的最高位和最低位必须为1。
b、当被传送信息（CRC码）任何一位发生错误时，被生成多项式做模2除后应该使余数不为0。
c、不同位发生错误时，应该使余数不同。
d、对余数继续做模2除，应使余数循环。

3、模2除（按位除）
模2除做法与算术除法类似，但每一位除（减）的结果不影响其它位，即不向上一位借位。所以实际上就是异或。然后再移位移位做下一位的模2减。步骤如下：
a、用除数对被除数最高几位做模2减，没有借位。
b、除数右移一位，若余数最高位为1，商为1，并对余数做模2减。若余数最高位为0，商为0，除数继续右移一位。
c、一直做到余数的位数小于除数时，该余数就是最终余数。





